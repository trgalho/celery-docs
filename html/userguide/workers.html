<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Workers Guide &#8212; Celery 3.1.25 documentation</title>
    
    <link rel="stylesheet" href="../_static/celery.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.1.25',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="next" title="Periodic Tasks" href="periodic-tasks.html" />
    <link rel="prev" title="Canvas: Designing Workflows" href="canvas.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="periodic-tasks.html" title="Periodic Tasks"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="canvas.html" title="Canvas: Designing Workflows"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Celery 3.1.25 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">User Guide</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
<div class="deck">

    
        <p>
        This document describes the current stable version of Celery (3.1). For development docs,
        <a href="http://docs.celeryproject.org/en/master/userguide/workers.html">go here</a>.
        </p>
    

</div>
    <div class="section" id="workers-guide">
<span id="guide-workers"></span><h1>Workers Guide<a class="headerlink" href="#workers-guide" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#starting-the-worker" id="id1">Starting the worker</a></li>
<li><a class="reference internal" href="#stopping-the-worker" id="id2">Stopping the worker</a></li>
<li><a class="reference internal" href="#restarting-the-worker" id="id3">Restarting the worker</a></li>
<li><a class="reference internal" href="#process-signals" id="id4">Process Signals</a></li>
<li><a class="reference internal" href="#variables-in-file-paths" id="id5">Variables in file paths</a></li>
<li><a class="reference internal" href="#concurrency" id="id6">Concurrency</a></li>
<li><a class="reference internal" href="#remote-control" id="id7">Remote control</a></li>
<li><a class="reference internal" href="#commands" id="id8">Commands</a></li>
<li><a class="reference internal" href="#time-limits" id="id9">Time Limits</a></li>
<li><a class="reference internal" href="#rate-limits" id="id10">Rate Limits</a></li>
<li><a class="reference internal" href="#max-tasks-per-child-setting" id="id11">Max tasks per child setting</a></li>
<li><a class="reference internal" href="#autoscaling" id="id12">Autoscaling</a></li>
<li><a class="reference internal" href="#queues" id="id13">Queues</a></li>
<li><a class="reference internal" href="#autoreloading" id="id14">Autoreloading</a></li>
<li><a class="reference internal" href="#inspecting-workers" id="id15">Inspecting workers</a></li>
<li><a class="reference internal" href="#additional-commands" id="id16">Additional Commands</a></li>
<li><a class="reference internal" href="#writing-your-own-remote-control-commands" id="id17">Writing your own remote control commands</a></li>
</ul>
</div>
<div class="section" id="starting-the-worker">
<span id="worker-starting"></span><h2><a class="toc-backref" href="#id1">Starting the worker</a><a class="headerlink" href="#starting-the-worker" title="Permalink to this headline">¶</a></h2>
<div class="sidebar">
<p class="first sidebar-title">Daemonizing</p>
<p class="last">You probably want to use a daemonization tool to start
in the background.  See <a class="reference internal" href="../tutorials/daemonizing.html#daemonizing"><span class="std std-ref">Running the worker as a daemon</span></a> for help
detaching the worker using popular daemonization tools.</p>
</div>
<p>You can start the worker in the foreground by executing the command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ celery -A proj worker -l info
</pre></div>
</div>
<p>For a full list of available command-line options see
<a class="reference internal" href="../reference/celery.bin.worker.html#module-celery.bin.worker" title="celery.bin.worker"><code class="xref py py-mod docutils literal"><span class="pre">worker</span></code></a>, or simply do:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ celery worker --help
</pre></div>
</div>
<p>You can also start multiple workers on the same machine. If you do so
be sure to give a unique name to each individual worker by specifying a
host name with the <code class="xref std std-option docutils literal"><span class="pre">--hostname|-n</span></code> argument:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ celery -A proj worker --loglevel<span class="o">=</span>INFO --concurrency<span class="o">=</span><span class="m">10</span> -n worker1.%h
$ celery -A proj worker --loglevel<span class="o">=</span>INFO --concurrency<span class="o">=</span><span class="m">10</span> -n worker2.%h
$ celery -A proj worker --loglevel<span class="o">=</span>INFO --concurrency<span class="o">=</span><span class="m">10</span> -n worker3.%h
</pre></div>
</div>
<p>The hostname argument can expand the following variables:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">%h</span></code>:  Hostname including domain name.</li>
<li><code class="docutils literal"><span class="pre">%n</span></code>:  Hostname only.</li>
<li><code class="docutils literal"><span class="pre">%d</span></code>:  Domain name only.</li>
</ul>
</div></blockquote>
<p>E.g. if the current hostname is <code class="docutils literal"><span class="pre">george.example.com</span></code> then
these will expand to:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">worker1.%h</span></code> -&gt; <code class="docutils literal"><span class="pre">worker1.george.example.com</span></code></li>
<li><code class="docutils literal"><span class="pre">worker1.%n</span></code> -&gt; <code class="docutils literal"><span class="pre">worker1.george</span></code></li>
<li><code class="docutils literal"><span class="pre">worker1.%d</span></code> -&gt; <code class="docutils literal"><span class="pre">worker1.example.com</span></code></li>
</ul>
</div></blockquote>
<div class="admonition-note-for-program-supervisord-users admonition">
<p class="first admonition-title">Note for <strong class="program">supervisord</strong> users.</p>
<p class="last">The <code class="docutils literal"><span class="pre">%</span></code> sign must be escaped by adding a second one: <cite>%%h</cite>.</p>
</div>
</div>
<div class="section" id="stopping-the-worker">
<span id="worker-stopping"></span><h2><a class="toc-backref" href="#id2">Stopping the worker</a><a class="headerlink" href="#stopping-the-worker" title="Permalink to this headline">¶</a></h2>
<p>Shutdown should be accomplished using the <code class="xref std std-sig docutils literal"><span class="pre">TERM</span></code> signal.</p>
<p>When shutdown is initiated the worker will finish all currently executing
tasks before it actually terminates, so if these tasks are important you should
wait for it to finish before doing anything drastic (like sending the <code class="xref std std-sig docutils literal"><span class="pre">KILL</span></code>
signal).</p>
<p>If the worker won&#8217;t shutdown after considerate time, for example because
of tasks stuck in an infinite-loop, you can use the <code class="xref std std-sig docutils literal"><span class="pre">KILL</span></code> signal to
force terminate the worker, but be aware that currently executing tasks will
be lost (unless the tasks have the <a class="reference internal" href="../reference/celery.app.task.html#celery.app.task.Task.acks_late" title="celery.app.task.Task.acks_late"><code class="xref py py-attr docutils literal"><span class="pre">acks_late</span></code></a>
option set).</p>
<p>Also as processes can&#8217;t override the <code class="xref std std-sig docutils literal"><span class="pre">KILL</span></code> signal, the worker will
not be able to reap its children, so make sure to do so manually.  This
command usually does the trick:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ ps auxww <span class="p">|</span> grep <span class="s1">&#39;celery worker&#39;</span> <span class="p">|</span> awk <span class="s1">&#39;{print $2}&#39;</span> <span class="p">|</span> xargs <span class="nb">kill</span> -9
</pre></div>
</div>
</div>
<div class="section" id="restarting-the-worker">
<span id="worker-restarting"></span><h2><a class="toc-backref" href="#id3">Restarting the worker</a><a class="headerlink" href="#restarting-the-worker" title="Permalink to this headline">¶</a></h2>
<p>To restart the worker you should send the <cite>TERM</cite> signal and start a new
instance.  The easiest way to manage workers for development
is by using <cite>celery multi</cite>:</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span></span>$ celery multi start <span class="m">1</span> -A proj -l info -c4 --pidfile<span class="o">=</span>/var/run/celery/%n.pid
$ celery multi restart <span class="m">1</span> --pidfile<span class="o">=</span>/var/run/celery/%n.pid
</pre></div>
</div>
</div></blockquote>
<p>For production deployments you should be using init scripts or other process
supervision systems (see <a class="reference internal" href="../tutorials/daemonizing.html#daemonizing"><span class="std std-ref">Running the worker as a daemon</span></a>).</p>
<p>Other than stopping then starting the worker to restart, you can also
restart the worker using the <code class="xref std std-sig docutils literal"><span class="pre">HUP</span></code> signal, but note that the worker
will be responsible for restarting itself so this is prone to problems and
is not recommended in production:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="nb">kill</span> -HUP <span class="nv">$pid</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Restarting by <code class="xref std std-sig docutils literal"><span class="pre">HUP</span></code> only works if the worker is running
in the background as a daemon (it does not have a controlling
terminal).</p>
<p class="last"><code class="xref std std-sig docutils literal"><span class="pre">HUP</span></code> is disabled on OS X because of a limitation on
that platform.</p>
</div>
</div>
<div class="section" id="process-signals">
<span id="worker-process-signals"></span><h2><a class="toc-backref" href="#id4">Process Signals</a><a class="headerlink" href="#process-signals" title="Permalink to this headline">¶</a></h2>
<p>The worker&#8217;s main process overrides the following signals:</p>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><code class="xref std std-sig docutils literal"><span class="pre">TERM</span></code></td>
<td>Warm shutdown, wait for tasks to complete.</td>
</tr>
<tr class="row-even"><td><code class="xref std std-sig docutils literal"><span class="pre">QUIT</span></code></td>
<td>Cold shutdown, terminate ASAP</td>
</tr>
<tr class="row-odd"><td><code class="xref std std-sig docutils literal"><span class="pre">USR1</span></code></td>
<td>Dump traceback for all active threads.</td>
</tr>
<tr class="row-even"><td><code class="xref std std-sig docutils literal"><span class="pre">USR2</span></code></td>
<td>Remote debug, see <a class="reference internal" href="../reference/celery.contrib.rdb.html#module-celery.contrib.rdb" title="celery.contrib.rdb"><code class="xref py py-mod docutils literal"><span class="pre">celery.contrib.rdb</span></code></a>.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="variables-in-file-paths">
<span id="worker-files"></span><h2><a class="toc-backref" href="#id5">Variables in file paths</a><a class="headerlink" href="#variables-in-file-paths" title="Permalink to this headline">¶</a></h2>
<p>The file path arguments for <a class="reference internal" href="../reference/celery.bin.base.html#cmdoption-f"><code class="xref std std-option docutils literal"><span class="pre">--logfile</span></code></a>, <a class="reference internal" href="../reference/celery.bin.base.html#cmdoption-pidfile"><code class="xref std std-option docutils literal"><span class="pre">--pidfile</span></code></a> and <code class="xref std std-option docutils literal"><span class="pre">--statedb</span></code>
can contain variables that the worker will expand:</p>
<div class="section" id="node-name-replacements">
<h3>Node name replacements<a class="headerlink" href="#node-name-replacements" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">%h</span></code>:  Hostname including domain name.</li>
<li><code class="docutils literal"><span class="pre">%n</span></code>:  Hostname only.</li>
<li><code class="docutils literal"><span class="pre">%d</span></code>:  Domain name only.</li>
<li><code class="docutils literal"><span class="pre">%i</span></code>:  Prefork pool process index or 0 if MainProcess.</li>
<li><code class="docutils literal"><span class="pre">%I</span></code>:  Prefork pool process index with separator.</li>
</ul>
<p>E.g. if the current hostname is <code class="docutils literal"><span class="pre">george.example.com</span></code> then
these will expand to:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">--logfile=%h.log</span></code> -&gt; <code class="file docutils literal"><span class="pre">george.example.com.log</span></code></li>
<li><code class="docutils literal"><span class="pre">--logfile=%n.log</span></code> -&gt; <code class="file docutils literal"><span class="pre">george.log</span></code></li>
<li><code class="docutils literal"><span class="pre">--logfile=%d</span></code> -&gt; <code class="file docutils literal"><span class="pre">example.com.log</span></code></li>
</ul>
</div>
<div class="section" id="prefork-pool-process-index">
<span id="worker-files-process-index"></span><h3>Prefork pool process index<a class="headerlink" href="#prefork-pool-process-index" title="Permalink to this headline">¶</a></h3>
<p>The prefork pool process index specifiers will expand into a different
filename depending on the process that will eventually need to open the file.</p>
<p>This can be used to specify one log file per child process.</p>
<p>Note that the numbers will stay within the process limit even if processes
exit or if autoscale/maxtasksperchild/time limits are used.  I.e. the number
is the <em>process index</em> not the process count or pid.</p>
<ul>
<li><p class="first"><code class="docutils literal"><span class="pre">%i</span></code> - Pool process index or 0 if MainProcess.</p>
<blockquote>
<div><p>Where <code class="docutils literal"><span class="pre">-n</span> <span class="pre">worker1&#64;example.com</span> <span class="pre">-c2</span> <span class="pre">-f</span> <span class="pre">%n-%i.log</span></code> will result in
three log files:</p>
<blockquote>
<div><ul class="simple">
<li><code class="file docutils literal"><span class="pre">worker1-0.log</span></code> (main process)</li>
<li><code class="file docutils literal"><span class="pre">worker1-1.log</span></code> (pool process 1)</li>
<li><code class="file docutils literal"><span class="pre">worker1-2.log</span></code> (pool process 2)</li>
</ul>
</div></blockquote>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">%I</span></code> - Pool process index with separator.</p>
<blockquote>
<div><p>Where <code class="docutils literal"><span class="pre">-n</span> <span class="pre">worker1&#64;example.com</span> <span class="pre">-c2</span> <span class="pre">-f</span> <span class="pre">%n%I.log</span></code> will result in
three log files:</p>
<blockquote>
<div><ul class="simple">
<li><code class="file docutils literal"><span class="pre">worker1.log</span></code> (main process)</li>
<li><code class="file docutils literal"><span class="pre">worker1-1.log</span></code> (pool process 1)</li>
<li><code class="file docutils literal"><span class="pre">worker1-2.log</span></code> (pool process 2)</li>
</ul>
</div></blockquote>
</div></blockquote>
</li>
</ul>
</div>
</div>
<div class="section" id="concurrency">
<span id="worker-concurrency"></span><h2><a class="toc-backref" href="#id6">Concurrency</a><a class="headerlink" href="#concurrency" title="Permalink to this headline">¶</a></h2>
<p>By default multiprocessing is used to perform concurrent execution of tasks,
but you can also use <a class="reference internal" href="concurrency/eventlet.html#concurrency-eventlet"><span class="std std-ref">Eventlet</span></a>.  The number
of worker processes/threads can be changed using the <code class="xref std std-option docutils literal"><span class="pre">--concurrency</span></code>
argument and defaults to the number of CPUs available on the machine.</p>
<div class="admonition-number-of-processes-multiprocessing-prefork-pool admonition">
<p class="first admonition-title">Number of processes (multiprocessing/prefork pool)</p>
<p class="last">More pool processes are usually better, but there&#8217;s a cut-off point where
adding more pool processes affects performance in negative ways.
There is even some evidence to support that having multiple worker
instances running, may perform better than having a single worker.
For example 3 workers with 10 pool processes each.  You need to experiment
to find the numbers that works best for you, as this varies based on
application, work load, task run times and other factors.</p>
</div>
</div>
<div class="section" id="remote-control">
<span id="worker-remote-control"></span><h2><a class="toc-backref" href="#id7">Remote control</a><a class="headerlink" href="#remote-control" title="Permalink to this headline">¶</a></h2>
<div class="versionadded">
<p><span class="versionmodified">New in version 2.0.</span></p>
</div>
<div class="sidebar">
<p class="first sidebar-title">The <code class="docutils literal"><span class="pre">celery</span></code> command</p>
<p class="last">The <strong class="program">celery</strong> program is used to execute remote control
commands from the command-line.  It supports all of the commands
listed below.  See <a class="reference internal" href="monitoring.html#monitoring-control"><span class="std std-ref">Management Command-line Utilities (inspect/control)</span></a> for more information.</p>
</div>
<p>pool support: <em>prefork, eventlet, gevent</em>, blocking:<em>threads/solo</em> (see note)
broker support: <em>amqp, redis</em></p>
<p>Workers have the ability to be remote controlled using a high-priority
broadcast message queue.  The commands can be directed to all, or a specific
list of workers.</p>
<p>Commands can also have replies.  The client can then wait for and collect
those replies.  Since there&#8217;s no central authority to know how many
workers are available in the cluster, there is also no way to estimate
how many workers may send a reply, so the client has a configurable
timeout — the deadline in seconds for replies to arrive in.  This timeout
defaults to one second.  If the worker doesn&#8217;t reply within the deadline
it doesn&#8217;t necessarily mean the worker didn&#8217;t reply, or worse is dead, but
may simply be caused by network latency or the worker being slow at processing
commands, so adjust the timeout accordingly.</p>
<p>In addition to timeouts, the client can specify the maximum number
of replies to wait for.  If a destination is specified, this limit is set
to the number of destination hosts.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The solo and threads pool supports remote control commands,
but any task executing will block any waiting control command,
so it is of limited use if the worker is very busy.  In that
case you must increase the timeout waiting for replies in the client.</p>
</div>
<div class="section" id="the-broadcast-function">
<span id="worker-broadcast-fun"></span><h3>The <a class="reference internal" href="../reference/celery.app.control.html#celery.app.control.Control.broadcast" title="celery.app.control.Control.broadcast"><code class="xref py py-meth docutils literal"><span class="pre">broadcast()</span></code></a> function.<a class="headerlink" href="#the-broadcast-function" title="Permalink to this headline">¶</a></h3>
<p>This is the client function used to send commands to the workers.
Some remote control commands also have higher-level interfaces using
<a class="reference internal" href="../reference/celery.app.control.html#celery.app.control.Control.broadcast" title="celery.app.control.Control.broadcast"><code class="xref py py-meth docutils literal"><span class="pre">broadcast()</span></code></a> in the background, like
<a class="reference internal" href="../reference/celery.app.control.html#celery.app.control.Control.rate_limit" title="celery.app.control.Control.rate_limit"><code class="xref py py-meth docutils literal"><span class="pre">rate_limit()</span></code></a> and <a class="reference internal" href="../reference/celery.app.control.html#celery.app.control.Control.ping" title="celery.app.control.Control.ping"><code class="xref py py-meth docutils literal"><span class="pre">ping()</span></code></a>.</p>
<p>Sending the <a class="reference internal" href="#std:control-rate_limit"><code class="xref std std-control docutils literal"><span class="pre">rate_limit</span></code></a> command and keyword arguments:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">broadcast</span><span class="p">(</span><span class="s1">&#39;rate_limit&#39;</span><span class="p">,</span>
<span class="gp">... </span>                         <span class="n">arguments</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;task_name&#39;</span><span class="p">:</span> <span class="s1">&#39;myapp.mytask&#39;</span><span class="p">,</span>
<span class="gp">... </span>                                    <span class="s1">&#39;rate_limit&#39;</span><span class="p">:</span> <span class="s1">&#39;200/m&#39;</span><span class="p">})</span>
</pre></div>
</div>
<p>This will send the command asynchronously, without waiting for a reply.
To request a reply you have to use the <cite>reply</cite> argument:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">broadcast</span><span class="p">(</span><span class="s1">&#39;rate_limit&#39;</span><span class="p">,</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="s1">&#39;task_name&#39;</span><span class="p">:</span> <span class="s1">&#39;myapp.mytask&#39;</span><span class="p">,</span> <span class="s1">&#39;rate_limit&#39;</span><span class="p">:</span> <span class="s1">&#39;200/m&#39;</span><span class="p">},</span> <span class="n">reply</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">[{&#39;worker1.example.com&#39;: &#39;New rate limit set successfully&#39;},</span>
<span class="go"> {&#39;worker2.example.com&#39;: &#39;New rate limit set successfully&#39;},</span>
<span class="go"> {&#39;worker3.example.com&#39;: &#39;New rate limit set successfully&#39;}]</span>
</pre></div>
</div>
<p>Using the <cite>destination</cite> argument you can specify a list of workers
to receive the command:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">broadcast</span><span class="p">(</span><span class="s1">&#39;rate_limit&#39;</span><span class="p">,</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="s1">&#39;task_name&#39;</span><span class="p">:</span> <span class="s1">&#39;myapp.mytask&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s1">&#39;rate_limit&#39;</span><span class="p">:</span> <span class="s1">&#39;200/m&#39;</span><span class="p">},</span> <span class="n">reply</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span>                            <span class="n">destination</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;worker1@example.com&#39;</span><span class="p">])</span>
<span class="go">[{&#39;worker1.example.com&#39;: &#39;New rate limit set successfully&#39;}]</span>
</pre></div>
</div>
<p>Of course, using the higher-level interface to set rate limits is much
more convenient, but there are commands that can only be requested
using <a class="reference internal" href="../reference/celery.app.control.html#celery.app.control.Control.broadcast" title="celery.app.control.Control.broadcast"><code class="xref py py-meth docutils literal"><span class="pre">broadcast()</span></code></a>.</p>
</div>
</div>
<div class="section" id="commands">
<h2><a class="toc-backref" href="#id8">Commands</a><a class="headerlink" href="#commands" title="Permalink to this headline">¶</a></h2>
<div class="section" id="revoke-revoking-tasks">
<span id="std:control-revoke"></span><h3><code class="docutils literal"><span class="pre">revoke</span></code>: Revoking tasks<a class="headerlink" href="#revoke-revoking-tasks" title="Permalink to this headline">¶</a></h3>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">pool support:</th><td class="field-body">all</td>
</tr>
<tr class="field-even field"><th class="field-name">broker support:</th><td class="field-body"><em>amqp, redis</em></td>
</tr>
<tr class="field-odd field"><th class="field-name">command:</th><td class="field-body"><strong class="program">celery -A proj control revoke &lt;task_id&gt;</strong></td>
</tr>
</tbody>
</table>
<p>All worker nodes keeps a memory of revoked task ids, either in-memory or
persistent on disk (see <a class="reference internal" href="#worker-persistent-revokes"><span class="std std-ref">Persistent revokes</span></a>).</p>
<p>When a worker receives a revoke request it will skip executing
the task, but it won&#8217;t terminate an already executing task unless
the <cite>terminate</cite> option is set.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The terminate option is a last resort for administrators when
a task is stuck.  It&#8217;s not for terminating the task,
it&#8217;s for terminating the process that is executing the task, and that
process may have already started processing another task at the point
when the signal is sent, so for this reason you must never call this
programatically.</p>
</div>
<p>If <cite>terminate</cite> is set the worker child process processing the task
will be terminated.  The default signal sent is <cite>TERM</cite>, but you can
specify this using the <cite>signal</cite> argument.  Signal can be the uppercase name
of any signal defined in the <a class="reference external" href="https://docs.python.org/dev/library/signal.html#module-signal" title="(in Python v3.11)"><code class="xref py py-mod docutils literal"><span class="pre">signal</span></code></a> module in the Python Standard
Library.</p>
<p>Terminating a task also revokes it.</p>
<p><strong>Example</strong></p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">revoke</span><span class="p">()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">AsyncResult</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span><span class="o">.</span><span class="n">revoke</span><span class="p">()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">revoke</span><span class="p">(</span><span class="s1">&#39;d9078da5-9915-40a0-bfa1-392c7bde42ed&#39;</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">revoke</span><span class="p">(</span><span class="s1">&#39;d9078da5-9915-40a0-bfa1-392c7bde42ed&#39;</span><span class="p">,</span>
<span class="gp">... </span>                   <span class="n">terminate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">revoke</span><span class="p">(</span><span class="s1">&#39;d9078da5-9915-40a0-bfa1-392c7bde42ed&#39;</span><span class="p">,</span>
<span class="gp">... </span>                   <span class="n">terminate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">signal</span><span class="o">=</span><span class="s1">&#39;SIGKILL&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="revoking-multiple-tasks">
<h3>Revoking multiple tasks<a class="headerlink" href="#revoking-multiple-tasks" title="Permalink to this headline">¶</a></h3>
<div class="versionadded">
<p><span class="versionmodified">New in version 3.1.</span></p>
</div>
<p>The revoke method also accepts a list argument, where it will revoke
several tasks at once.</p>
<p><strong>Example</strong></p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">revoke</span><span class="p">([</span>
<span class="gp">... </span>   <span class="s1">&#39;7993b0aa-1f0b-4780-9af0-c47c0858b3f2&#39;</span><span class="p">,</span>
<span class="gp">... </span>   <span class="s1">&#39;f565793e-b041-4b2b-9ca4-dca22762a55d&#39;</span><span class="p">,</span>
<span class="gp">... </span>   <span class="s1">&#39;d9d35e03-2997-42d0-a13e-64a66b88a618&#39;</span><span class="p">,</span>
<span class="go">])</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">GroupResult.revoke</span></code> method takes advantage of this since
version 3.1.</p>
</div>
<div class="section" id="persistent-revokes">
<span id="worker-persistent-revokes"></span><h3>Persistent revokes<a class="headerlink" href="#persistent-revokes" title="Permalink to this headline">¶</a></h3>
<p>Revoking tasks works by sending a broadcast message to all the workers,
the workers then keep a list of revoked tasks in memory.  When a worker starts
up it will synchronize revoked tasks with other workers in the cluster.</p>
<p>The list of revoked tasks is in-memory so if all workers restart the list
of revoked ids will also vanish.  If you want to preserve this list between
restarts you need to specify a file for these to be stored in by using the <cite>&#8211;statedb</cite>
argument to <strong class="program">celery worker</strong>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>celery -A proj worker -l info --statedb<span class="o">=</span>/var/run/celery/worker.state
</pre></div>
</div>
<p>or if you use <strong class="program">celery multi</strong> you will want to create one file per
worker instance so then you can use the <cite>%n</cite> format to expand the current node
name:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>celery multi start <span class="m">2</span> -l info --statedb<span class="o">=</span>/var/run/celery/%n.state
</pre></div>
</div>
<p>See also <a class="reference internal" href="#worker-files"><span class="std std-ref">Variables in file paths</span></a></p>
<p>Note that remote control commands must be working for revokes to work.
Remote control commands are only supported by the RabbitMQ (amqp) and Redis
at this point.</p>
</div>
</div>
<div class="section" id="time-limits">
<span id="worker-time-limits"></span><h2><a class="toc-backref" href="#id9">Time Limits</a><a class="headerlink" href="#time-limits" title="Permalink to this headline">¶</a></h2>
<div class="versionadded">
<p><span class="versionmodified">New in version 2.0.</span></p>
</div>
<p>pool support: <em>prefork/gevent</em></p>
<div class="sidebar">
<p class="first sidebar-title">Soft, or hard?</p>
<p class="last">The time limit is set in two values, <cite>soft</cite> and <cite>hard</cite>.
The soft time limit allows the task to catch an exception
to clean up before it is killed: the hard timeout is not catchable
and force terminates the task.</p>
</div>
<p>A single task can potentially run forever, if you have lots of tasks
waiting for some event that will never happen you will block the worker
from processing new tasks indefinitely.  The best way to defend against
this scenario happening is enabling time limits.</p>
<p>The time limit (<cite>&#8211;time-limit</cite>) is the maximum number of seconds a task
may run before the process executing it is terminated and replaced by a
new process.  You can also enable a soft time limit (<cite>&#8211;soft-time-limit</cite>),
this raises an exception the task can catch to clean up before the hard
time limit kills it:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">myapp</span> <span class="kn">import</span> <span class="n">app</span>
<span class="kn">from</span> <span class="nn">celery.exceptions</span> <span class="kn">import</span> <span class="n">SoftTimeLimitExceeded</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">task</span>
<span class="k">def</span> <span class="nf">mytask</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">do_work</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">SoftTimeLimitExceeded</span><span class="p">:</span>
        <span class="n">clean_up_in_a_hurry</span><span class="p">()</span>
</pre></div>
</div>
<p>Time limits can also be set using the <a class="reference internal" href="../configuration.html#std:setting-CELERYD_TASK_TIME_LIMIT"><code class="xref std std-setting docutils literal"><span class="pre">CELERYD_TASK_TIME_LIMIT</span></code></a> /
<a class="reference internal" href="../configuration.html#std:setting-CELERYD_TASK_SOFT_TIME_LIMIT"><code class="xref std std-setting docutils literal"><span class="pre">CELERYD_TASK_SOFT_TIME_LIMIT</span></code></a> settings.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Time limits do not currently work on Windows and other
platforms that do not support the <code class="docutils literal"><span class="pre">SIGUSR1</span></code> signal.</p>
</div>
<div class="section" id="changing-time-limits-at-runtime">
<h3>Changing time limits at runtime<a class="headerlink" href="#changing-time-limits-at-runtime" title="Permalink to this headline">¶</a></h3>
<div class="versionadded">
<p><span class="versionmodified">New in version 2.3.</span></p>
</div>
<p>broker support: <em>amqp, redis</em></p>
<p>There is a remote control command that enables you to change both soft
and hard time limits for a task — named <code class="docutils literal"><span class="pre">time_limit</span></code>.</p>
<p>Example changing the time limit for the <code class="docutils literal"><span class="pre">tasks.crawl_the_web</span></code> task
to have a soft time limit of one minute, and a hard time limit of
two minutes:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">time_limit</span><span class="p">(</span><span class="s1">&#39;tasks.crawl_the_web&#39;</span><span class="p">,</span>
<span class="go">                           soft=60, hard=120, reply=True)</span>
<span class="go">[{&#39;worker1.example.com&#39;: {&#39;ok&#39;: &#39;time limits set successfully&#39;}}]</span>
</pre></div>
</div>
<p>Only tasks that starts executing after the time limit change will be affected.</p>
</div>
</div>
<div class="section" id="rate-limits">
<span id="worker-rate-limits"></span><h2><a class="toc-backref" href="#id10">Rate Limits</a><a class="headerlink" href="#rate-limits" title="Permalink to this headline">¶</a></h2>
<div class="section" id="changing-rate-limits-at-runtime">
<span id="std:control-rate_limit"></span><h3>Changing rate-limits at runtime<a class="headerlink" href="#changing-rate-limits-at-runtime" title="Permalink to this headline">¶</a></h3>
<p>Example changing the rate limit for the <cite>myapp.mytask</cite> task to execute
at most 200 tasks of that type every minute:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">rate_limit</span><span class="p">(</span><span class="s1">&#39;myapp.mytask&#39;</span><span class="p">,</span> <span class="s1">&#39;200/m&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The above does not specify a destination, so the change request will affect
all worker instances in the cluster.  If you only want to affect a specific
list of workers you can include the <code class="docutils literal"><span class="pre">destination</span></code> argument:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">rate_limit</span><span class="p">(</span><span class="s1">&#39;myapp.mytask&#39;</span><span class="p">,</span> <span class="s1">&#39;200/m&#39;</span><span class="p">,</span>
<span class="gp">... </span>           <span class="n">destination</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;celery@worker1.example.com&#39;</span><span class="p">])</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This won&#8217;t affect workers with the
<a class="reference internal" href="../configuration.html#std:setting-CELERY_DISABLE_RATE_LIMITS"><code class="xref std std-setting docutils literal"><span class="pre">CELERY_DISABLE_RATE_LIMITS</span></code></a> setting enabled.</p>
</div>
</div>
</div>
<div class="section" id="max-tasks-per-child-setting">
<span id="worker-maxtasksperchild"></span><h2><a class="toc-backref" href="#id11">Max tasks per child setting</a><a class="headerlink" href="#max-tasks-per-child-setting" title="Permalink to this headline">¶</a></h2>
<div class="versionadded">
<p><span class="versionmodified">New in version 2.0.</span></p>
</div>
<p>pool support: <em>prefork</em></p>
<p>With this option you can configure the maximum number of tasks
a worker can execute before it&#8217;s replaced by a new process.</p>
<p>This is useful if you have memory leaks you have no control over
for example from closed source C extensions.</p>
<p>The option can be set using the workers <cite>&#8211;maxtasksperchild</cite> argument
or using the <a class="reference internal" href="../configuration.html#std:setting-CELERYD_MAX_TASKS_PER_CHILD"><code class="xref std std-setting docutils literal"><span class="pre">CELERYD_MAX_TASKS_PER_CHILD</span></code></a> setting.</p>
</div>
<div class="section" id="autoscaling">
<span id="worker-autoscaling"></span><h2><a class="toc-backref" href="#id12">Autoscaling</a><a class="headerlink" href="#autoscaling" title="Permalink to this headline">¶</a></h2>
<div class="versionadded">
<p><span class="versionmodified">New in version 2.2.</span></p>
</div>
<p>pool support: <em>prefork</em>, <em>gevent</em></p>
<p>The <em>autoscaler</em> component is used to dynamically resize the pool
based on load:</p>
<ul class="simple">
<li><dl class="first docutils">
<dt>The autoscaler adds more pool processes when there is work to do,</dt>
<dd><ul class="first last">
<li>and starts removing processes when the workload is low.</li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>It&#8217;s enabled by the <code class="xref std std-option docutils literal"><span class="pre">--autoscale</span></code> option, which needs two
numbers: the maximum and minimum number of pool processes:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">autoscale</span><span class="o">=</span><span class="n">AUTOSCALE</span>
     <span class="n">Enable</span> <span class="n">autoscaling</span> <span class="n">by</span> <span class="n">providing</span>
     <span class="n">max_concurrency</span><span class="p">,</span><span class="n">min_concurrency</span><span class="o">.</span>  <span class="n">Example</span><span class="p">:</span>
       <span class="o">--</span><span class="n">autoscale</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="mi">3</span> <span class="p">(</span><span class="n">always</span> <span class="n">keep</span> <span class="mi">3</span> <span class="n">processes</span><span class="p">,</span> <span class="n">but</span> <span class="n">grow</span> <span class="n">to</span>
      <span class="mi">10</span> <span class="k">if</span> <span class="n">necessary</span><span class="p">)</span><span class="o">.</span>
</pre></div>
</div>
<p>You can also define your own rules for the autoscaler by subclassing
<code class="xref py py-class docutils literal"><span class="pre">Autoscaler</span></code>.
Some ideas for metrics include load average or the amount of memory available.
You can specify a custom autoscaler with the <a class="reference internal" href="../configuration.html#std:setting-CELERYD_AUTOSCALER"><code class="xref std std-setting docutils literal"><span class="pre">CELERYD_AUTOSCALER</span></code></a> setting.</p>
</div>
<div class="section" id="queues">
<span id="worker-queues"></span><h2><a class="toc-backref" href="#id13">Queues</a><a class="headerlink" href="#queues" title="Permalink to this headline">¶</a></h2>
<p>A worker instance can consume from any number of queues.
By default it will consume from all queues defined in the
<a class="reference internal" href="../configuration.html#std:setting-CELERY_QUEUES"><code class="xref std std-setting docutils literal"><span class="pre">CELERY_QUEUES</span></code></a> setting (which if not specified defaults to the
queue named <code class="docutils literal"><span class="pre">celery</span></code>).</p>
<p>You can specify what queues to consume from at startup,
by giving a comma separated list of queues to the <code class="xref std std-option docutils literal"><span class="pre">-Q</span></code> option:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ celery -A proj worker -l info -Q foo,bar,baz
</pre></div>
</div>
<p>If the queue name is defined in <a class="reference internal" href="../configuration.html#std:setting-CELERY_QUEUES"><code class="xref std std-setting docutils literal"><span class="pre">CELERY_QUEUES</span></code></a> it will use that
configuration, but if it&#8217;s not defined in the list of queues Celery will
automatically generate a new queue for you (depending on the
<a class="reference internal" href="../configuration.html#std:setting-CELERY_CREATE_MISSING_QUEUES"><code class="xref std std-setting docutils literal"><span class="pre">CELERY_CREATE_MISSING_QUEUES</span></code></a> option).</p>
<p>You can also tell the worker to start and stop consuming from a queue at
runtime using the remote control commands <a class="reference internal" href="#std:control-add_consumer"><code class="xref std std-control docutils literal"><span class="pre">add_consumer</span></code></a> and
<a class="reference internal" href="#std:control-cancel_consumer"><code class="xref std std-control docutils literal"><span class="pre">cancel_consumer</span></code></a>.</p>
<div class="section" id="queues-adding-consumers">
<span id="std:control-add_consumer"></span><h3>Queues: Adding consumers<a class="headerlink" href="#queues-adding-consumers" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="#std:control-add_consumer"><code class="xref std std-control docutils literal"><span class="pre">add_consumer</span></code></a> control command will tell one or more workers
to start consuming from a queue. This operation is idempotent.</p>
<p>To tell all workers in the cluster to start consuming from a queue
named &#8220;<code class="docutils literal"><span class="pre">foo</span></code>&#8221; you can use the <strong class="program">celery control</strong> program:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ celery -A proj control add_consumer foo
-&gt; worker1.local: OK
    started consuming from u<span class="s1">&#39;foo&#39;</span>
</pre></div>
</div>
<p>If you want to specify a specific worker you can use the
<code class="xref std std-option docutils literal"><span class="pre">--destination`</span></code> argument:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ celery -A proj control add_consumer foo -d worker1.local
</pre></div>
</div>
<p>The same can be accomplished dynamically using the <a class="reference internal" href="../reference/celery.app.control.html#celery.app.control.Control.add_consumer" title="celery.app.control.Control.add_consumer"><code class="xref py py-meth docutils literal"><span class="pre">app.control.add_consumer()</span></code></a> method:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">add_consumer</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">[{u&#39;worker1.local&#39;: {u&#39;ok&#39;: u&quot;already consuming from u&#39;foo&#39;&quot;}}]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">add_consumer</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span>                         <span class="n">destination</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;worker1@example.com&#39;</span><span class="p">])</span>
<span class="go">[{u&#39;worker1.local&#39;: {u&#39;ok&#39;: u&quot;already consuming from u&#39;foo&#39;&quot;}}]</span>
</pre></div>
</div>
<p>By now I have only shown examples using automatic queues,
If you need more control you can also specify the exchange, routing_key and
even other options:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">add_consumer</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">queue</span><span class="o">=</span><span class="s1">&#39;baz&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">exchange</span><span class="o">=</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">exchange_type</span><span class="o">=</span><span class="s1">&#39;topic&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">routing_key</span><span class="o">=</span><span class="s1">&#39;media.*&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">options</span><span class="o">=</span><span class="p">{</span>
<span class="gp">... </span>        <span class="s1">&#39;queue_durable&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
<span class="gp">... </span>        <span class="s1">&#39;exchange_durable&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
<span class="gp">... </span>    <span class="p">},</span>
<span class="gp">... </span>    <span class="n">reply</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">destination</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;w1@example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;w2@example.com&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="queues-canceling-consumers">
<span id="std:control-cancel_consumer"></span><h3>Queues: Canceling consumers<a class="headerlink" href="#queues-canceling-consumers" title="Permalink to this headline">¶</a></h3>
<p>You can cancel a consumer by queue name using the <a class="reference internal" href="#std:control-cancel_consumer"><code class="xref std std-control docutils literal"><span class="pre">cancel_consumer</span></code></a>
control command.</p>
<p>To force all workers in the cluster to cancel consuming from a queue
you can use the <strong class="program">celery control</strong> program:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ celery -A proj control cancel_consumer foo
</pre></div>
</div>
<p>The <code class="xref std std-option docutils literal"><span class="pre">--destination</span></code> argument can be used to specify a worker, or a
list of workers, to act on the command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ celery -A proj control cancel_consumer foo -d worker1.local
</pre></div>
</div>
<p>You can also cancel consumers programmatically using the
<a class="reference internal" href="../reference/celery.app.control.html#celery.app.control.Control.cancel_consumer" title="celery.app.control.Control.cancel_consumer"><code class="xref py py-meth docutils literal"><span class="pre">app.control.cancel_consumer()</span></code></a> method:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>&gt;&gt;&gt; app.control.cancel_consumer<span class="o">(</span><span class="s1">&#39;foo&#39;</span>, <span class="nv">reply</span><span class="o">=</span>True<span class="o">)</span>
<span class="o">[{</span>u<span class="s1">&#39;worker1.local&#39;</span>: <span class="o">{</span>u<span class="s1">&#39;ok&#39;</span>: u<span class="s2">&quot;no longer consuming from u&#39;foo&#39;&quot;</span><span class="o">}}]</span>
</pre></div>
</div>
</div>
<div class="section" id="queues-list-of-active-queues">
<span id="std:control-active_queues"></span><h3>Queues: List of active queues<a class="headerlink" href="#queues-list-of-active-queues" title="Permalink to this headline">¶</a></h3>
<p>You can get a list of queues that a worker consumes from by using
the <a class="reference internal" href="#std:control-active_queues"><code class="xref std std-control docutils literal"><span class="pre">active_queues</span></code></a> control command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ celery -A proj inspect active_queues
<span class="o">[</span>...<span class="o">]</span>
</pre></div>
</div>
<p>Like all other remote control commands this also supports the
<code class="xref std std-option docutils literal"><span class="pre">--destination</span></code> argument used to specify which workers should
reply to the request:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ celery -A proj inspect active_queues -d worker1.local
<span class="o">[</span>...<span class="o">]</span>
</pre></div>
</div>
<p>This can also be done programmatically by using the
<code class="xref py py-meth docutils literal"><span class="pre">app.control.inspect.active_queues()</span></code> method:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">inspect</span><span class="p">()</span><span class="o">.</span><span class="n">active_queues</span><span class="p">()</span>
<span class="go">[...]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">inspect</span><span class="p">([</span><span class="s1">&#39;worker1.local&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">active_queues</span><span class="p">()</span>
<span class="go">[...]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="autoreloading">
<span id="worker-autoreloading"></span><h2><a class="toc-backref" href="#id14">Autoreloading</a><a class="headerlink" href="#autoreloading" title="Permalink to this headline">¶</a></h2>
<div class="versionadded">
<p><span class="versionmodified">New in version 2.5.</span></p>
</div>
<p>pool support: <em>prefork, eventlet, gevent, threads, solo</em></p>
<p>Starting <strong class="program">celery worker</strong> with the <code class="xref std std-option docutils literal"><span class="pre">--autoreload</span></code> option will
enable the worker to watch for file system changes to all imported task
modules (and also any non-task modules added to the
<a class="reference internal" href="../configuration.html#std:setting-CELERY_IMPORTS"><code class="xref std std-setting docutils literal"><span class="pre">CELERY_IMPORTS</span></code></a> setting or the <code class="xref std std-option docutils literal"><span class="pre">-I|--include</span></code> option).</p>
<p>This is an experimental feature intended for use in development only,
using auto-reload in production is discouraged as the behavior of reloading
a module in Python is undefined, and may cause hard to diagnose bugs and
crashes.  Celery uses the same approach as the auto-reloader found in e.g.
the Django <code class="docutils literal"><span class="pre">runserver</span></code> command.</p>
<p>When auto-reload is enabled the worker starts an additional thread
that watches for changes in the file system.  New modules are imported,
and already imported modules are reloaded whenever a change is detected,
and if the prefork pool is used the child processes will finish the work
they are doing and exit, so that they can be replaced by fresh processes
effectively reloading the code.</p>
<p>File system notification backends are pluggable, and it comes with three
implementations:</p>
<ul>
<li><p class="first">inotify (Linux)</p>
<blockquote>
<div><p>Used if the <code class="xref py py-mod docutils literal"><span class="pre">pyinotify</span></code> library is installed.
If you are running on Linux this is the recommended implementation,
to install the <code class="xref py py-mod docutils literal"><span class="pre">pyinotify</span></code> library you have to run the following
command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ pip install pyinotify
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">kqueue (OS X/BSD)</p>
</li>
<li><p class="first">stat</p>
<blockquote>
<div><p>The fallback implementation simply polls the files using <code class="docutils literal"><span class="pre">stat</span></code> and is very
expensive.</p>
</div></blockquote>
</li>
</ul>
<p>You can force an implementation by setting the <span class="target" id="index-0"></span><code class="xref std std-envvar docutils literal"><span class="pre">CELERYD_FSNOTIFY</span></code>
environment variable:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ env <span class="nv">CELERYD_FSNOTIFY</span><span class="o">=</span>stat celery worker -l info --autoreload
</pre></div>
</div>
<span class="target" id="worker-autoreload"></span><div class="section" id="pool-restart-command">
<span id="std:control-pool_restart"></span><h3>Pool Restart Command<a class="headerlink" href="#pool-restart-command" title="Permalink to this headline">¶</a></h3>
<div class="versionadded">
<p><span class="versionmodified">New in version 2.5.</span></p>
</div>
<p>Requires the <a class="reference internal" href="../configuration.html#std:setting-CELERYD_POOL_RESTARTS"><code class="xref std std-setting docutils literal"><span class="pre">CELERYD_POOL_RESTARTS</span></code></a> setting to be enabled.</p>
<p>The remote control command <a class="reference internal" href="#std:control-pool_restart"><code class="xref std std-control docutils literal"><span class="pre">pool_restart</span></code></a> sends restart requests to
the workers child processes.  It is particularly useful for forcing
the worker to import new modules, or for reloading already imported
modules.  This command does not interrupt executing tasks.</p>
<div class="section" id="example">
<h4>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h4>
<p>Running the following command will result in the <cite>foo</cite> and <cite>bar</cite> modules
being imported by the worker processes:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">broadcast</span><span class="p">(</span><span class="s1">&#39;pool_restart&#39;</span><span class="p">,</span>
<span class="gp">... </span>                      <span class="n">arguments</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;modules&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">]})</span>
</pre></div>
</div>
<p>Use the <code class="docutils literal"><span class="pre">reload</span></code> argument to reload modules it has already imported:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">broadcast</span><span class="p">(</span><span class="s1">&#39;pool_restart&#39;</span><span class="p">,</span>
<span class="gp">... </span>                      <span class="n">arguments</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;modules&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">],</span>
<span class="gp">... </span>                                 <span class="s1">&#39;reload&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
</pre></div>
</div>
<p>If you don&#8217;t specify any modules then all known tasks modules will
be imported/reloaded:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">broadcast</span><span class="p">(</span><span class="s1">&#39;pool_restart&#39;</span><span class="p">,</span> <span class="n">arguments</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;reload&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">modules</span></code> argument is a list of modules to modify. <code class="docutils literal"><span class="pre">reload</span></code>
specifies whether to reload modules if they have previously been imported.
By default <code class="docutils literal"><span class="pre">reload</span></code> is disabled. The <cite>pool_restart</cite> command uses the
Python <code class="xref py py-func docutils literal"><span class="pre">reload()</span></code> function to reload modules, or you can provide
your own custom reloader by passing the <code class="docutils literal"><span class="pre">reloader</span></code> argument.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Module reloading comes with caveats that are documented in <code class="xref py py-func docutils literal"><span class="pre">reload()</span></code>.
Please read this documentation and make sure your modules are suitable
for reloading.</p>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<ul class="last simple">
<li><a class="reference external" href="http://pyunit.sourceforge.net/notes/reloading.html">http://pyunit.sourceforge.net/notes/reloading.html</a></li>
<li><a class="reference external" href="http://www.indelible.org/ink/python-reloading/">http://www.indelible.org/ink/python-reloading/</a></li>
<li><a class="reference external" href="http://docs.python.org/library/functions.html#reload">http://docs.python.org/library/functions.html#reload</a></li>
</ul>
</div>
</div>
</div>
</div>
<div class="section" id="inspecting-workers">
<span id="worker-inspect"></span><h2><a class="toc-backref" href="#id15">Inspecting workers</a><a class="headerlink" href="#inspecting-workers" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="../reference/celery.app.control.html#celery.app.control.Control.inspect" title="celery.app.control.Control.inspect"><code class="xref py py-class docutils literal"><span class="pre">app.control.inspect</span></code></a> lets you inspect running workers.  It
uses remote control commands under the hood.</p>
<p>You can also use the <code class="docutils literal"><span class="pre">celery</span></code> command to inspect workers,
and it supports the same commands as the <a class="reference internal" href="../reference/celery.app.control.html#celery.app.control.Control" title="celery.app.control.Control"><code class="xref py py-class docutils literal"><span class="pre">app.control</span></code></a> interface.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Inspect all nodes.</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">i</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">inspect</span><span class="p">()</span>

<span class="c1"># Specify multiple nodes to inspect.</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">i</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">inspect</span><span class="p">([</span><span class="s1">&#39;worker1.example.com&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;worker2.example.com&#39;</span><span class="p">])</span>

<span class="c1"># Specify a single node to inspect.</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">i</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">inspect</span><span class="p">(</span><span class="s1">&#39;worker1.example.com&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="dump-of-registered-tasks">
<span id="worker-inspect-registered-tasks"></span><h3>Dump of registered tasks<a class="headerlink" href="#dump-of-registered-tasks" title="Permalink to this headline">¶</a></h3>
<p>You can get a list of tasks registered in the worker using the
<code class="xref py py-meth docutils literal"><span class="pre">registered()</span></code>:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">i</span><span class="o">.</span><span class="n">registered</span><span class="p">()</span>
<span class="go">[{&#39;worker1.example.com&#39;: [&#39;tasks.add&#39;,</span>
<span class="go">                          &#39;tasks.sleeptask&#39;]}]</span>
</pre></div>
</div>
</div>
<div class="section" id="dump-of-currently-executing-tasks">
<span id="worker-inspect-active-tasks"></span><h3>Dump of currently executing tasks<a class="headerlink" href="#dump-of-currently-executing-tasks" title="Permalink to this headline">¶</a></h3>
<p>You can get a list of active tasks using
<code class="xref py py-meth docutils literal"><span class="pre">active()</span></code>:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">i</span><span class="o">.</span><span class="n">active</span><span class="p">()</span>
<span class="go">[{&#39;worker1.example.com&#39;:</span>
<span class="go">    [{&#39;name&#39;: &#39;tasks.sleeptask&#39;,</span>
<span class="go">      &#39;id&#39;: &#39;32666e9b-809c-41fa-8e93-5ae0c80afbbf&#39;,</span>
<span class="go">      &#39;args&#39;: &#39;(8,)&#39;,</span>
<span class="go">      &#39;kwargs&#39;: &#39;{}&#39;}]}]</span>
</pre></div>
</div>
</div>
<div class="section" id="dump-of-scheduled-eta-tasks">
<span id="worker-inspect-eta-schedule"></span><h3>Dump of scheduled (ETA) tasks<a class="headerlink" href="#dump-of-scheduled-eta-tasks" title="Permalink to this headline">¶</a></h3>
<p>You can get a list of tasks waiting to be scheduled by using
<code class="xref py py-meth docutils literal"><span class="pre">scheduled()</span></code>:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">i</span><span class="o">.</span><span class="n">scheduled</span><span class="p">()</span>
<span class="go">[{&#39;worker1.example.com&#39;:</span>
<span class="go">    [{&#39;eta&#39;: &#39;2010-06-07 09:07:52&#39;, &#39;priority&#39;: 0,</span>
<span class="go">      &#39;request&#39;: {</span>
<span class="go">        &#39;name&#39;: &#39;tasks.sleeptask&#39;,</span>
<span class="go">        &#39;id&#39;: &#39;1a7980ea-8b19-413e-91d2-0b74f3844c4d&#39;,</span>
<span class="go">        &#39;args&#39;: &#39;[1]&#39;,</span>
<span class="go">        &#39;kwargs&#39;: &#39;{}&#39;}},</span>
<span class="go">     {&#39;eta&#39;: &#39;2010-06-07 09:07:53&#39;, &#39;priority&#39;: 0,</span>
<span class="go">      &#39;request&#39;: {</span>
<span class="go">        &#39;name&#39;: &#39;tasks.sleeptask&#39;,</span>
<span class="go">        &#39;id&#39;: &#39;49661b9a-aa22-4120-94b7-9ee8031d219d&#39;,</span>
<span class="go">        &#39;args&#39;: &#39;[2]&#39;,</span>
<span class="go">        &#39;kwargs&#39;: &#39;{}&#39;}}]}]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">These are tasks with an eta/countdown argument, not periodic tasks.</p>
</div>
</div>
<div class="section" id="dump-of-reserved-tasks">
<span id="worker-inspect-reserved"></span><h3>Dump of reserved tasks<a class="headerlink" href="#dump-of-reserved-tasks" title="Permalink to this headline">¶</a></h3>
<p>Reserved tasks are tasks that have been received, but are still waiting to be
executed.</p>
<p>You can get a list of these using
<code class="xref py py-meth docutils literal"><span class="pre">reserved()</span></code>:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">i</span><span class="o">.</span><span class="n">reserved</span><span class="p">()</span>
<span class="go">[{&#39;worker1.example.com&#39;:</span>
<span class="go">    [{&#39;name&#39;: &#39;tasks.sleeptask&#39;,</span>
<span class="go">      &#39;id&#39;: &#39;32666e9b-809c-41fa-8e93-5ae0c80afbbf&#39;,</span>
<span class="go">      &#39;args&#39;: &#39;(8,)&#39;,</span>
<span class="go">      &#39;kwargs&#39;: &#39;{}&#39;}]}]</span>
</pre></div>
</div>
</div>
<div class="section" id="statistics">
<span id="worker-statistics"></span><h3>Statistics<a class="headerlink" href="#statistics" title="Permalink to this headline">¶</a></h3>
<p>The remote control command <code class="docutils literal"><span class="pre">inspect</span> <span class="pre">stats</span></code> (or
<code class="xref py py-meth docutils literal"><span class="pre">stats()</span></code>) will give you a long list of useful (or not
so useful) statistics about the worker:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ celery -A proj inspect stats
</pre></div>
</div>
<p>The output will include the following fields:</p>
<ul>
<li><p class="first"><code class="docutils literal"><span class="pre">broker</span></code></p>
<blockquote>
<div><p>Section for broker information.</p>
<ul>
<li><p class="first"><code class="docutils literal"><span class="pre">connect_timeout</span></code></p>
<blockquote>
<div><p>Timeout in seconds (int/float) for establishing a new connection.</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">heartbeat</span></code></p>
<blockquote>
<div><p>Current heartbeat value (set by client).</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">hostname</span></code></p>
<blockquote>
<div><p>Hostname of the remote broker.</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">insist</span></code></p>
<blockquote>
<div><p>No longer used.</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">login_method</span></code></p>
<blockquote>
<div><p>Login method used to connect to the broker.</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">port</span></code></p>
<blockquote>
<div><p>Port of the remote broker.</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">ssl</span></code></p>
<blockquote>
<div><p>SSL enabled/disabled.</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">transport</span></code></p>
<blockquote>
<div><p>Name of transport used (e.g. <code class="docutils literal"><span class="pre">amqp</span></code> or <code class="docutils literal"><span class="pre">redis</span></code>)</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">transport_options</span></code></p>
<blockquote>
<div><p>Options passed to transport.</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">uri_prefix</span></code></p>
<blockquote>
<div><p>Some transports expects the host name to be an URL, this applies to
for example SQLAlchemy where the host name part is the connection URI:</p>
<blockquote>
<div><p>redis+socket:///tmp/redis.sock</p>
</div></blockquote>
<p>In this example the uri prefix will be <code class="docutils literal"><span class="pre">redis</span></code>.</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">userid</span></code></p>
<blockquote>
<div><p>User id used to connect to the broker with.</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">virtual_host</span></code></p>
<blockquote>
<div><p>Virtual host used.</p>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">clock</span></code></p>
<blockquote>
<div><p>Value of the workers logical clock.  This is a positive integer and should
be increasing every time you receive statistics.</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">pid</span></code></p>
<blockquote>
<div><p>Process id of the worker instance (Main process).</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">pool</span></code></p>
<blockquote>
<div><p>Pool-specific section.</p>
<ul>
<li><p class="first"><code class="docutils literal"><span class="pre">max-concurrency</span></code></p>
<blockquote>
<div><p>Max number of processes/threads/green threads.</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">max-tasks-per-child</span></code></p>
<blockquote>
<div><p>Max number of tasks a thread may execute before being recycled.</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">processes</span></code></p>
<blockquote>
<div><p>List of pids (or thread-id&#8217;s).</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">put-guarded-by-semaphore</span></code></p>
<blockquote>
<div><p>Internal</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">timeouts</span></code></p>
<blockquote>
<div><p>Default values for time limits.</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">writes</span></code></p>
<blockquote>
<div><p>Specific to the prefork pool, this shows the distribution of writes
to each process in the pool when using async I/O.</p>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">prefetch_count</span></code></p>
<blockquote>
<div><p>Current prefetch count value for the task consumer.</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">rusage</span></code></p>
<blockquote>
<div><p>System usage statistics.  The fields available may be different
on your platform.</p>
<p>From <em class="manpage">getrusage(2)</em>:</p>
<ul>
<li><p class="first"><code class="docutils literal"><span class="pre">stime</span></code></p>
<blockquote>
<div><p>Time spent in operating system code on behalf of this process.</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">utime</span></code></p>
<blockquote>
<div><p>Time spent executing user instructions.</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">maxrss</span></code></p>
<blockquote>
<div><p>The maximum resident size used by this process (in kilobytes).</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">idrss</span></code></p>
<blockquote>
<div><p>Amount of unshared memory used for data (in kilobytes times ticks of
execution)</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">isrss</span></code></p>
<blockquote>
<div><p>Amount of unshared memory used for stack space (in kilobytes times
ticks of execution)</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">ixrss</span></code></p>
<blockquote>
<div><p>Amount of memory shared with other processes (in kilobytes times
ticks of execution).</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">inblock</span></code></p>
<blockquote>
<div><p>Number of times the file system had to read from the disk on behalf of
this process.</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">oublock</span></code></p>
<blockquote>
<div><p>Number of times the file system has to write to disk on behalf of
this process.</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">majflt</span></code></p>
<blockquote>
<div><p>Number of page faults which were serviced by doing I/O.</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">minflt</span></code></p>
<blockquote>
<div><p>Number of page faults which were serviced without doing I/O.</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">msgrcv</span></code></p>
<blockquote>
<div><p>Number of IPC messages received.</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">msgsnd</span></code></p>
<blockquote>
<div><p>Number of IPC messages sent.</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">nvcsw</span></code></p>
<blockquote>
<div><p>Number of times this process voluntarily invoked a context switch.</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">nivcsw</span></code></p>
<blockquote>
<div><p>Number of times an involuntary context switch took place.</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">nsignals</span></code></p>
<blockquote>
<div><p>Number of signals received.</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">nswap</span></code></p>
<blockquote>
<div><p>The number of times this process was swapped entirely out of memory.</p>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">total</span></code></p>
<blockquote>
<div><p>List of task names and a total number of times that task have been
executed since worker start.</p>
</div></blockquote>
</li>
</ul>
</div>
</div>
<div class="section" id="additional-commands">
<h2><a class="toc-backref" href="#id16">Additional Commands</a><a class="headerlink" href="#additional-commands" title="Permalink to this headline">¶</a></h2>
<div class="section" id="remote-shutdown">
<span id="std:control-shutdown"></span><h3>Remote shutdown<a class="headerlink" href="#remote-shutdown" title="Permalink to this headline">¶</a></h3>
<p>This command will gracefully shut down the worker remotely:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">broadcast</span><span class="p">(</span><span class="s1">&#39;shutdown&#39;</span><span class="p">)</span> <span class="c1"># shutdown all workers</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">broadcast</span><span class="p">(</span><span class="s1">&#39;shutdown, destination=&quot;worker1@example.com&quot;)</span>
</pre></div>
</div>
</div>
<div class="section" id="ping">
<span id="std:control-ping"></span><h3>Ping<a class="headerlink" href="#ping" title="Permalink to this headline">¶</a></h3>
<p>This command requests a ping from alive workers.
The workers reply with the string &#8216;pong&#8217;, and that&#8217;s just about it.
It will use the default one second timeout for replies unless you specify
a custom timeout:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">ping</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="go">[{&#39;worker1.example.com&#39;: &#39;pong&#39;},</span>
<span class="go"> {&#39;worker2.example.com&#39;: &#39;pong&#39;},</span>
<span class="go"> {&#39;worker3.example.com&#39;: &#39;pong&#39;}]</span>
</pre></div>
</div>
<p><a class="reference internal" href="../reference/celery.app.control.html#celery.app.control.Control.ping" title="celery.app.control.Control.ping"><code class="xref py py-meth docutils literal"><span class="pre">ping()</span></code></a> also supports the <cite>destination</cite> argument,
so you can specify which workers to ping:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ping</span><span class="p">([</span><span class="s1">&#39;worker2.example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;worker3.example.com&#39;</span><span class="p">])</span>
<span class="go">[{&#39;worker2.example.com&#39;: &#39;pong&#39;},</span>
<span class="go"> {&#39;worker3.example.com&#39;: &#39;pong&#39;}]</span>
</pre></div>
</div>
<span class="target" id="worker-enable-events"></span><span class="target" id="std:control-enable_events"></span></div>
<div class="section" id="enable-disable-events">
<span id="std:control-disable_events"></span><h3>Enable/disable events<a class="headerlink" href="#enable-disable-events" title="Permalink to this headline">¶</a></h3>
<p>You can enable/disable events by using the <cite>enable_events</cite>,
<cite>disable_events</cite> commands.  This is useful to temporarily monitor
a worker using <strong class="program">celery events</strong>/<strong class="program">celerymon</strong>.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">enable_events</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">disable_events</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="writing-your-own-remote-control-commands">
<span id="worker-custom-control-commands"></span><h2><a class="toc-backref" href="#id17">Writing your own remote control commands</a><a class="headerlink" href="#writing-your-own-remote-control-commands" title="Permalink to this headline">¶</a></h2>
<p>Remote control commands are registered in the control panel and
they take a single argument: the current
<code class="xref py py-class docutils literal"><span class="pre">ControlDispatch</span></code> instance.
From there you have access to the active
<code class="xref py py-class docutils literal"><span class="pre">Consumer</span></code> if needed.</p>
<p>Here&#8217;s an example control command that increments the task prefetch count:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">celery.worker.control</span> <span class="kn">import</span> <span class="n">Panel</span>

<span class="nd">@Panel</span><span class="o">.</span><span class="n">register</span>
<span class="k">def</span> <span class="nf">increase_prefetch_count</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">state</span><span class="o">.</span><span class="n">consumer</span><span class="o">.</span><span class="n">qos</span><span class="o">.</span><span class="n">increment_eventually</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;ok&#39;</span><span class="p">:</span> <span class="s1">&#39;prefetch count incremented&#39;</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><p class="logo"><a href="../index.html">
  <img class="logo" src="http://cloud.github.com/downloads/celery/celery/celery_128.png" alt="Logo"/>
</a></p>
<div id="donate">
    <b>Donations welcome:</b>
    <form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
    <input type="hidden" name="cmd" value="_s-xclick">
    <input type="hidden" name="encrypted" value="-----BEGIN PKCS7-----MIIHTwYJKoZIhvcNAQcEoIIHQDCCBzwCAQExggEwMIIBLAIBADCBlDCBjjELMAkGA1UEBhMCVVMxCzAJBgNVBAgTAkNBMRYwFAYDVQQHEw1Nb3VudGFpbiBWaWV3MRQwEgYDVQQKEwtQYXlQYWwgSW5jLjETMBEGA1UECxQKbGl2ZV9jZXJ0czERMA8GA1UEAxQIbGl2ZV9hcGkxHDAaBgkqhkiG9w0BCQEWDXJlQHBheXBhbC5jb20CAQAwDQYJKoZIhvcNAQEBBQAEgYA2+c723xlntHKQYQR9yn9BEtUhDoUUlnOqhniqvNMWB4k2R0JpVkrNSu5JCbdjNOqDXKHoRfIWe3HXJJMPZBJKFMD5Izprb6xEZlTGaWnlrGXFfkdBaILQQgWYqV0DnuNmtDXCvfYmyu0p1K04wLjAJ1ufnBSP1UaS6BTcoIOOuTELMAkGBSsOAwIaBQAwgcwGCSqGSIb3DQEHATAUBggqhkiG9w0DBwQIFg/2qPwa7UCAgah20QLIllcp0VHazYo2C9h8c6gn8MTcTnpW0WFXhz9ylc/i5dCXabkrrLBBfg8NygAuvYRr4k1zdC0AJIgsV/6rSAhehabRvjRDH2EZ8OieqHfIPfkAcTm+JqbS6Z27lXkebYPnJzhkZxW7+ZC6hU/H40JFXChTag8lhqJfZELiOZLWxxilj2mkwlkdMx1YL6lcPAA7ajpAwjsnJYd/9VxLA6MDmcOu+TKgggOHMIIDgzCCAuygAwIBAgIBADANBgkqhkiG9w0BAQUFADCBjjELMAkGA1UEBhMCVVMxCzAJBgNVBAgTAkNBMRYwFAYDVQQHEw1Nb3VudGFpbiBWaWV3MRQwEgYDVQQKEwtQYXlQYWwgSW5jLjETMBEGA1UECxQKbGl2ZV9jZXJ0czERMA8GA1UEAxQIbGl2ZV9hcGkxHDAaBgkqhkiG9w0BCQEWDXJlQHBheXBhbC5jb20wHhcNMDQwMjEzMTAxMzE1WhcNMzUwMjEzMTAxMzE1WjCBjjELMAkGA1UEBhMCVVMxCzAJBgNVBAgTAkNBMRYwFAYDVQQHEw1Nb3VudGFpbiBWaWV3MRQwEgYDVQQKEwtQYXlQYWwgSW5jLjETMBEGA1UECxQKbGl2ZV9jZXJ0czERMA8GA1UEAxQIbGl2ZV9hcGkxHDAaBgkqhkiG9w0BCQEWDXJlQHBheXBhbC5jb20wgZ8wDQYJKoZIhvcNAQEBBQADgY0AMIGJAoGBAMFHTt38RMxLXJyO2SmS+Ndl72T7oKJ4u4uw+6awntALWh03PewmIJuzbALScsTS4sZoS1fKciBGoh11gIfHzylvkdNe/hJl66/RGqrj5rFb08sAABNTzDTiqqNpJeBsYs/c2aiGozptX2RlnBktH+SUNpAajW724Nv2Wvhif6sFAgMBAAGjge4wgeswHQYDVR0OBBYEFJaffLvGbxe9WT9S1wob7BDWZJRrMIG7BgNVHSMEgbMwgbCAFJaffLvGbxe9WT9S1wob7BDWZJRroYGUpIGRMIGOMQswCQYDVQQGEwJVUzELMAkGA1UECBMCQ0ExFjAUBgNVBAcTDU1vdW50YWluIFZpZXcxFDASBgNVBAoTC1BheVBhbCBJbmMuMRMwEQYDVQQLFApsaXZlX2NlcnRzMREwDwYDVQQDFAhsaXZlX2FwaTEcMBoGCSqGSIb3DQEJARYNcmVAcGF5cGFsLmNvbYIBADAMBgNVHRMEBTADAQH/MA0GCSqGSIb3DQEBBQUAA4GBAIFfOlaagFrl71+jq6OKidbWFSE+Q4FqROvdgIONth+8kSK//Y/4ihuE4Ymvzn5ceE3S/iBSQQMjyvb+s2TWbQYDwcp129OPIbD9epdr4tJOUNiSojw7BHwYRiPh58S1xGlFgHFXwrEBb3dgNbMUa+u4qectsMAXpVHnD9wIyfmHMYIBmjCCAZYCAQEwgZQwgY4xCzAJBgNVBAYTAlVTMQswCQYDVQQIEwJDQTEWMBQGA1UEBxMNTW91bnRhaW4gVmlldzEUMBIGA1UEChMLUGF5UGFsIEluYy4xEzARBgNVBAsUCmxpdmVfY2VydHMxETAPBgNVBAMUCGxpdmVfYXBpMRwwGgYJKoZIhvcNAQkBFg1yZUBwYXlwYWwuY29tAgEAMAkGBSsOAwIaBQCgXTAYBgkqhkiG9w0BCQMxCwYJKoZIhvcNAQcBMBwGCSqGSIb3DQEJBTEPFw0xNTEyMTAxOTEzMzBaMCMGCSqGSIb3DQEJBDEWBBTUno4gI/mmaVaGVpgB/CWwQd3DeDANBgkqhkiG9w0BAQEFAASBgFmZ1j1Ss/FNl/JRIOakhBJEdm2KGLH0d2ewwTYIgIkEKSdc5Rg2/2xFS/dglcs5Te3R2GzaqjGlNSKldsk/MgZP/BudpHAASQ09hrfDy5TaBlRRl1Yu0WzGBKcVm/WRh0v2TVV8vBHVGiJD+aY5epgRXXI/XUKD0bp8tVV1T7LS-----END PKCS7-----
    ">
    <input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
    <img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
    </form>
</div>
  <h4>Previous topic</h4>
  <p class="topless"><a href="canvas.html"
                        title="previous chapter">Canvas: Designing Workflows</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="periodic-tasks.html"
                        title="next chapter">Periodic Tasks</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/userguide/workers.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="periodic-tasks.html" title="Periodic Tasks"
             >next</a> |</li>
        <li class="right" >
          <a href="canvas.html" title="Canvas: Designing Workflows"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Celery 3.1.25 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >User Guide</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; <a href="../copyright.html">Copyright</a> 2009-2015, Ask Solem &amp; Contributors.
    </div>
  </body>
</html>